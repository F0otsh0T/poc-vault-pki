# patch-basic-annotations.yaml
spec:
  template:
    metadata:
      annotations:
        vault.hashicorp.com/agent-inject: "true"
        vault.hashicorp.com/agent-image: vault:1.4.2
        vault.hashicorp.com/agent-inject-secret-ca.crt: pki_int/issue/demo-svc-cluster-local
        vault.hashicorp.com/agent-inject-template-ca.crt: |
          {{- with secret "pki_int/issue/demo-svc-cluster-local" "common_name=demo.svc.cluster.local" -}}
          {{ .Data.issuing_ca }}
          {{- end }}
        vault.hashicorp.com/agent-inject-secret-ca.chain: pki_int/issue/demo-svc-cluster-local
        vault.hashicorp.com/agent-inject-template-ca.chain: |
          {{- with secret "pki_int/issue/demo-svc-cluster-local" "common_name=demo.svc.cluster.local" -}}
          {{ .Data.ca_chain }}
          {{- end }}
        vault.hashicorp.com/agent-inject-secret-kv: hello/poc
        vault.hashicorp.com/agent-inject-secret-pki_int_all: pki_int/issue/demo-svc-cluster-local

        vault.hashicorp.com/agent-inject-template-pki_int_all: |
          {{- with secret "pki_int/issue/demo-svc-cluster-local" "common_name=demo.svc.cluster.local" -}}
          {{ . }}
          {{- end }}
        vault.hashicorp.com/agent-inject-secret-pki_int_data: pki_int/issue/demo-svc-cluster-local
        vault.hashicorp.com/agent-inject-template-pki_int_data: |
          {{- with secret "pki_int/issue/demo-svc-cluster-local" "common_name=demo.svc.cluster.local" -}}
          {{ .Data }}
          {{- end }}
        vault.hashicorp.com/agent-inject-secret-server.crt: pki_int/issue/demo-svc-cluster-local
        vault.hashicorp.com/agent-inject-template-server.crt: |
          {{- with secret "pki_int/issue/demo-svc-cluster-local" "common_name=demo.svc.cluster.local" -}}
          {{ .Data.crtificate }}
          {{- end }}
        vault.hashicorp.com/agent-inject-secret-server.key: pki_int/issue/demo-svc-cluster-local
        vault.hashicorp.com/agent-inject-template-server.key: |
          {{- with secret "pki_int/issue/demo-svc-cluster-local" "common_name=demo.svc.cluster.local" -}}
          {{ .Data.private_key }}
          {{- end }}
        vault.hashicorp.com/agent-inject-secret-server.serial: pki_int/issue/demo-svc-cluster-local
        vault.hashicorp.com/agent-inject-template-server.serial: |
          {{- with secret "pki_int/issue/demo-svc-cluster-local" "common_name=demo.svc.cluster.local" -}}
          {{ .Data.serial_number }}
          {{- end }}
        vault.hashicorp.com/role: vaultdemo
        vault.hashicorp.com/service: http://vaultdemo.demo.svc.cluster.local:8200